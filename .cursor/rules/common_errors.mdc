---
description: 
globs: 
alwaysApply: false
---
# Errores Comunes - AquaLytics

## **1. Over-Engineering en State Management**

### **Error:**
Crear stores de Zustand con m√°s de 500 l√≠neas incluyendo m√©todos no implementados.

### **S√≠ntoma:**
```typescript
// metrics-store.ts con 736 l√≠neas
export const useMetricsStore = create<MetricsStore>((set, get) => ({
  // ... 200 l√≠neas de estado
  analyzePerformance: () => { /* TODO */ },
  generateRankings: () => { /* TODO */ },
  // ... m√°s TODOs
}))
```

### **Soluci√≥n:**
```typescript
// metrics-store.ts simplificado (<200 l√≠neas)
export const useMetricsStore = create<MetricsStore>((set) => ({
  metrics: [],
  loading: false,
  error: null,
  
  // Solo m√©todos esenciales implementados
  fetchMetrics: async () => {
    set({ loading: true })
    const { data, error } = await supabase.from('registros').select()
    set({ metrics: data || [], loading: false, error })
  },
  
  addMetric: (metric) => set((state) => ({ 
    metrics: [...state.metrics, metric] 
  }))
}))
```

## **2. Validaciones Excesivas en CSV**

### **Error:**
Implementar validaciones granulares por celda con detecci√≥n de anomal√≠as complejas.

### **S√≠ntoma:**
```python
# 678 l√≠neas de validaciones
def validate_row(self, row_data, row_number):
    errors = []
    # Validaci√≥n tipo por tipo
    # Detecci√≥n de anomal√≠as
    # Validaciones l√≥gicas complejas
    # ...
```

### **Soluci√≥n:**
```python
def validate_csv_simple(df):
    """Validaci√≥n b√°sica para MVP"""
    # Solo validaciones cr√≠ticas
    required_cols = ['fecha', 'nombre', 't_total', 'brz_total']
    
    # Verificar columnas
    missing = set(required_cols) - set(df.columns)
    if missing:
        return False, f"Columnas faltantes: {missing}"
    
    # Convertir tipos b√°sicos
    df['t_total'] = pd.to_numeric(df['t_total'], errors='coerce')
    df['brz_total'] = pd.to_numeric(df['brz_total'], errors='coerce')
    
    # Eliminar filas con datos cr√≠ticos faltantes
    df_clean = df.dropna(subset=['t_total', 'brz_total'])
    
    return True, df_clean
```

## **3. Configuraci√≥n de Herramientas No Utilizadas**

### **Error:**
Configurar webpack para SVG cuando no hay SVGs en el proyecto.

### **S√≠ntoma:**
```typescript
// next.config.ts
webpack: (config) => {
  config.module.rules.push({
    test: /\.svg$/,
    use: ['@svgr/webpack']
  });
  return config;
}
```

### **Soluci√≥n:**
Eliminar configuraciones no utilizadas y agregar solo cuando sea necesario.

## **4. Carpetas Vac√≠as sin Prop√≥sito**

### **Error:**
Mantener carpetas vac√≠as como `/public/icons/` y `/public/images/`.

### **Soluci√≥n:**
```bash
# Opci√≥n 1: Eliminar si no se necesitan
rm -rf public/icons public/images

# Opci√≥n 2: Agregar .gitkeep con explicaci√≥n
echo "# Carpeta para iconos del tema Phoenix" > public/icons/.gitkeep
```

## **5. CORS Demasiado Permisivo**

### **Error:**
```json
// vercel.json
"Access-Control-Allow-Origin": "*"
```

### **Soluci√≥n:**
```json
// Para desarrollo
"Access-Control-Allow-Origin": "http://localhost:3000"

// Para producci√≥n
"Access-Control-Allow-Origin": "https://aqualytics.vercel.app"
```

## **6. Imports y Exports No Utilizados**

### **Error:**
Exportar funciones de hooks que no existen o no se usan.

### **S√≠ntoma:**
```typescript
// store/index.ts
export { useSwimmerOperations } from './swimmers-store' // No existe
```

### **Soluci√≥n:**
Solo exportar lo que realmente existe y se usa:
```typescript
// store/index.ts
export { useSwimmersStore } from './swimmers-store'
export { useMetricsStore } from './metrics-store'
```

## **7. Dependencias en Cliente que Deber√≠an Estar en Servidor**

### **Error:**
```typescript
// next.config.ts
serverExternalPackages: ['pandas', 'numpy']
```

### **Soluci√≥n:**
Estas dependencias deben manejarse exclusivamente en el backend Python, no en Next.js.

## **Checklist de Prevenci√≥n**

Antes de cada commit:
- [ ] ¬øTodos los archivos tienen menos de 300 l√≠neas?
- [ ] ¬øTodos los m√©todos TODO han sido eliminados?
- [ ] ¬øLas validaciones son las m√≠nimas necesarias?
- [ ] ¬øNo hay carpetas vac√≠as sin prop√≥sito?
- [ ] ¬øLas configuraciones corresponden a herramientas en uso?
- [ ] ¬øLos imports/exports son todos v√°lidos?
- [ ] ¬øEl c√≥digo nuevo sigue el principio YAGNI?

## **SSR - Server Side Rendering**

### Problema: "window is not defined" con Chart.js
```bash
# Error t√≠pico:
ReferenceError: window is not defined at hammerjs/hammer.js
```

**Soluci√≥n:**
```typescript
// ‚ùå NO: Importar Chart.js plugins directamente
import zoomPlugin from 'chartjs-plugin-zoom'

// ‚úÖ S√ç: Condicionar registro de plugins
if (typeof window !== 'undefined') {
  ChartJS.register(/* plugins solo en cliente */)
}

// ‚úÖ S√ç: Dynamic imports con ssr: false
const MyChart = dynamic(() => import('./Chart'), {
  ssr: false,
  loading: () => <div>Cargando gr√°fico...</div>
})
```

### Problema: Cache corrupto de Next.js
```bash
# Error t√≠pico:
Cannot find module './447.js'
```

**Soluci√≥n:**
```bash
# Limpiar cache y reiniciar
rm -rf .next
npm run dev
```

### Problema: Plugins de Chart.js en SSR
```typescript
// ‚ùå NO: chartjs-plugin-zoom causa problemas de SSR
import zoomPlugin from 'chartjs-plugin-zoom'

// ‚úÖ S√ç: Evitar plugins que dependan de window
// Usar solo funcionalidad b√°sica para MVP
```

## **Chart.js - Gr√°fico Radar**

### Problema: Solapamiento de labels en radar charts
```typescript
// ‚ùå NO: Sin padding adecuado
scales: {
  r: {
    pointLabels: {
      font: { size: 14 } // Muy grande sin padding
    }
  }
}

// ‚úÖ S√ç: Con padding y font size apropiado
scales: {  
  r: {
    pointLabels: {
      font: { size: 12, weight: 'bold' },
      padding: 20, // Evita solapamiento
    }
  }
}
```

### Problema: Font weight types en Chart.js
```typescript
// ‚ùå NO: String weight inv√°lido
weight: '500' as const // TypeScript error

// ‚úÖ S√ç: Usar valores v√°lidos
weight: 'bold' as const // 'normal', 'bold', 'bolder', 'lighter'
```

## **Dashboard UX**

### Problema: Labels t√©cnicos en m√©tricas
```typescript
// ‚ùå NO: Nomenclatura t√©cnica
{ metric: 'avgSpeed', displayName: 'avgSpeed' }

// ‚úÖ S√ç: Labels amigables
{ metric: 'avgSpeed', displayName: 'Velocidad Promedio', unit: 'm/s' }
```

### Problema: Ranking con puntuaci√≥n general confusa
```typescript
// ‚ùå NO: OverallScore genera confusi√≥n
showOverallScore={true}

// ‚úÖ S√ç: Enfocarse en m√©tricas espec√≠ficas
showOverallScore={false}
```

## **Patr√≥n MVP de Datos Simulados**

### Para mantener coherencia en datos simulados:
```typescript
// ‚úÖ PATR√ìN: Datos simulados realistas
const generateSimulatedData = () => ({
  baseValue: 1.8, // Valor base realista
  variation: (Math.random() - 0.5) * 0.3, // Variaci√≥n natural
  humanLabels: true, // Siempre usar labels user-friendly
})
```

## **Selectores de Fechas**

### Implementar filtros de tiempo consistentemente:
```typescript
// ‚úÖ PATR√ìN: Selector est√°ndar
const [dateRange, setDateRange] = useState<'7d' | '30d' | '3m' | '1y'>('30d')

// Labels consistentes
const getDateRangeLabel = (range) => {
  switch (range) {
    case '7d': return '√öltimos 7 d√≠as'
    case '30d': return '√öltimos 30 d√≠as' 
    case '3m': return '√öltimos 3 meses'
    case '1y': return '√öltimo a√±o'
  }
}
```

## **Manejo de Estados de Carga**

### Skeleton screens para gr√°ficos:
```typescript
// ‚úÖ PATR√ìN: Loading consistente
if (loading) {
  return (
    <div className="animate-pulse">
      <div className="h-4 bg-muted rounded w-48 mb-4"></div>
      <div className="h-64 bg-muted/30 rounded"></div>
    </div>
  )
}
```

## **Validaci√≥n de Errores Frecuentes**

- ‚úÖ **Verificar font weights v√°lidos** en Chart.js
- ‚úÖ **Usar padding adecuado** en radar charts (min 15px)
- ‚úÖ **Labels traducidos** nunca nomenclatura t√©cnica
- ‚úÖ **stepSize apropiado** para escalas de porcentaje (20-25)
- ‚úÖ **Datos simulados realistas** con variaci√≥n natural
- ‚úÖ **Loading states** en todos los gr√°ficos
- ‚úÖ **Dynamic imports** para Chart.js (`ssr: false`)
- ‚úÖ **Limpiar cache .next** despu√©s de errores de m√≥dulos
- ‚úÖ **Evitar plugins SSR-incompatibles** (chartjs-plugin-zoom)

## **ModalManager ReactNode Type Error**

### Problema: Type 'unknown' is not assignable to type 'ReactNode'
```typescript
// ‚ùå ERROR: modalData de tipo unknown en JSX
{modalData && (
  <pre>{String(modalData)}</pre>
)}
```

**Soluci√≥n Temporal para MVP:**
```typescript
// ‚úÖ WORKAROUND: Desactivar error espec√≠fico
{modalData && (
  <pre>
    {/* eslint-disable-next-line @typescript-eslint/no-explicit-any */}
    {String(modalData as any)}
  </pre>
)}
```

**Soluci√≥n Futura (Post-MVP):**
- Definir tipos espec√≠ficos para modalData
- Implementar type guards apropiados
- Usar discriminated unions para diferentes tipos de modal

## **React Keys Duplicadas - [object Object]**

### **Error:**
"Encountered two children with the same key, `[object Object]`. Keys should be unique..."

### **Causa Ra√≠z:**
Se est√° usando un objeto completo como key en lugar de una propiedad √∫nica del objeto.

### **S√≠ntoma:**
```typescript
// ‚ùå ERROR: Objeto sin key √∫nica en map
return metricasGrupo.map(metricDef => ({
  metric: metricDef.shortLabel,
  unit: metricDef.unit,
  // Sin key √∫nica - React usa [object Object]
}))
```

### **Soluci√≥n:**
```typescript
// ‚úÖ CORRECTO: Agregar key √∫nica basada en propiedad √∫nica
return metricasGrupo.map(metricDef => ({
  key: metricDef.parametro, // Key √∫nica para evitar warnings
  metric: metricDef.shortLabel,
  unit: metricDef.unit,
  // ...resto de propiedades
}))
```

### **Prevenci√≥n:**
- Siempre agregar una propiedad `key` √∫nica cuando se crean objetos en `.map()`
- Usar IDs, nombres √∫nicos, o √≠ndices como keys
- Nunca usar objetos completos como keys en React

### **Comando de Verificaci√≥n:**
```bash
# Buscar maps sin keys expl√≠citas
grep -r "\.map.*=>" aqualytics/lib/hooks/ | grep -v "key:"
```

### **Variante: Filtros con Datos Nested de Supabase**
```typescript
// ‚ùå ERROR: Acceso directo sin filtro robusto
const distancias = [...new Set(registros.map(r => r.distancia))]

// ‚úÖ CORRECTO: Filtros robustos para datos nested
const distanciasRaw = registros
  .map((r: any) => r.distancia?.distancia)
  .filter((dist): dist is number => typeof dist === 'number' && dist > 0)
const distancias = [...new Set(distanciasRaw)]
```

---
*Actualizar esta regla cuando se encuentren nuevos patrones de errores*

## **Iconos Gigantes Morados - Clases CSS No Definidas**

### **Problema:** 
Iconos o elementos aparecen con tama√±os incorrectos y colores morados en puertos 3000/3001.

### **Causa Ra√≠z:**
Referencias a clases CSS de TailwindCSS que no est√°n definidas en el tema Phoenix.

### **S√≠ntomas:**
```typescript
// ‚ùå ERROR: Clases CSS no definidas
className="bg-gradient-to-r from-phoenix-blue/5 to-phoenix-purple/5 border-phoenix-blue/20"

// ‚ùå ERROR: Colores que no existen en el tema
className="text-purple-600 dark:text-purple-400"
```

### **Soluci√≥n:**
```typescript
// ‚úÖ CORRECTO: Usar colores definidos en el tema Phoenix
className="bg-gradient-to-r from-phoenix-red/5 to-phoenix-orange/5 border-phoenix-red/20"

// ‚úÖ CORRECTO: Usar colores Phoenix consistentes
className="text-phoenix-red dark:text-phoenix-orange"
```

### **Definir Colores Faltantes en globals.css:**
```css
/* Agregar a :root en globals.css */
--phoenix-blue: #3B82F6;
--phoenix-purple: #A855F7;

/* Agregar a @theme inline */
--color-phoenix-blue: var(--phoenix-blue);
--color-phoenix-purple: var(--phoenix-purple);
```

### **Archivos Comunes Afectados:**
- `components/forms/CompetitionForm.tsx` (l√≠nea 205)
- `components/forms/ValidationReport.tsx` (l√≠nea 52)
- `app/data-entry/csv/page.tsx` (l√≠nea 429)

### **Checklist de Verificaci√≥n:**
- [ ] Todos los colores `phoenix-*` est√°n definidos en `globals.css`
- [ ] No hay referencias a `purple-600` o `blue-600` sin el prefijo `phoenix-`
- [ ] Las clases de gradiente usan colores existentes
- [ ] Los iconos tienen tama√±os consistentes (`h-4 w-4`, `h-5 w-5`)

### **Comando de Verificaci√≥n:**
```bash
# Buscar clases CSS no definidas
grep -r "phoenix-blue\|phoenix-purple" aqualytics/components/
grep -r "text-purple\|text-blue" aqualytics/components/ | grep -v "phoenix"
```

## **Python vs Python3 Command Error**

### **Error:**
Usar `python` en lugar de `python3` en sistemas Linux/Ubuntu.

### **S√≠ntoma:**
```bash
# ‚ùå ERROR: Command 'python' not found
fru@frulap:~/AquaLytics-dev/api$ python -m uvicorn test_csv_server:app --host 0.0.0.0 --port 30010
Command 'python' not found, did you mean:
  command 'python3' from deb python3
```

### **Soluci√≥n:**
```bash
# ‚úÖ CORRECTO: Usar python3 expl√≠citamente
cd /home/fru/AquaLytics-dev/api && python3 -m uvicorn test_csv_server:app --host 0.0.0.0 --port 30010

# ‚úÖ ALTERNATIVA: Activar virtual environment
cd /home/fru/AquaLytics-dev/api
source venv/bin/activate
python -m uvicorn test_csv_server:app --host 0.0.0.0 --port 30010
```

### **Prevenci√≥n:**
- Siempre usar `python3` en comandos de terminal
- Activar el virtual environment antes de ejecutar scripts Python
- Verificar que `venv/bin/activate` funciona correctamente

## **Missing Python Dependencies Error**

### **Error:**
Dependencias Python no instaladas despu√©s de clonar repositorio.

### **S√≠ntoma:**
```bash
# ‚ùå ERROR: Module not found
/usr/bin/python3: No module named uvicorn
```

### **Soluci√≥n:**
```bash
# ‚úÖ CORRECTO: Activar virtual environment e instalar dependencias
cd /home/fru/AquaLytics-dev/api
source venv/bin/activate
pip install -r requirements.txt

# Verificar instalaci√≥n
pip list | grep uvicorn
```

### **Prevenci√≥n:**
- Siempre verificar que las dependencias est√°n instaladas
- Documentar el proceso de setup en README
- Usar requirements.txt actualizado

## **Asumir Configuraciones Sin Verificar**

### **Error:**
Hacer suposiciones sobre configuraci√≥n de puertos, rutas o dependencias sin revisar el c√≥digo real.

### **S√≠ntoma:**
```bash
# ‚ùå ERROR: Usar puerto incorrecto sin verificar
uvicorn test_csv_server:app --host 0.0.0.0 --port 30010
# Cuando el c√≥digo real dice:
# uvicorn.run(app, host="0.0.0.0", port=8000)
```

### **Ejemplo Real:**
```python
# El c√≥digo real en test_csv_server.py l√≠nea 261:
if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)  # ‚Üê PUERTO 8000
```

### **Soluci√≥n:**
```bash
# ‚úÖ SIEMPRE: Leer el c√≥digo primero
grep -n "port.*=" api/test_csv_server.py
# O simplemente:
cat api/test_csv_server.py | tail -5

# ‚úÖ DESPU√âS: Ejecutar con configuraci√≥n real
cd api && source venv/bin/activate && python test_csv_server.py
```

### **Regla de Oro:**
**NUNCA ASUMIR - SIEMPRE VERIFICAR**
1. üîç **Leer el c√≥digo** antes de ejecutar comandos
2. üìù **Verificar configuraciones** (puertos, rutas, variables)
3. ‚ùì **Preguntar al usuario** si algo no est√° claro
4. ‚úÖ **Confirmar funcionamiento** antes de continuar

### **Checklist de Verificaci√≥n:**
- [ ] ¬øLe√≠ la configuraci√≥n real del c√≥digo?
- [ ] ¬øVerifiqu√© puertos, rutas y dependencias?
- [ ] ¬øConfirm√© que funciona antes de asumir siguiente paso?
- [ ] ¬øPregunt√© al usuario si tuve dudas?

## **M√∫ltiples Instancias de Next.js en Puertos Consecutivos**

### **Error:**
Asumir que puerto 3000 est√° libre sin verificar puertos consecutivos ocupados por instancias previas.

### **S√≠ntoma:**
```bash
# ‚ùå ERROR: Asumir puerto libre sin verificar
"Puerto 3000 no hay nada corriendo"

# Pero la realidad:
‚ö† Port 3000 is in use, using available port 3006 instead.
```

### **Causa Ra√≠z:**
```bash
# M√∫ltiples instancias de Next.js activas:
tcp LISTEN *:3000 users:(("next-server",pid=298522))
tcp LISTEN *:3001 users:(("next-server",pid=327639))
tcp LISTEN *:3002 users:(("next-server",pid=342165))
tcp LISTEN *:3003 users:(("next-server",pid=346655))
tcp LISTEN *:3004 users:(("next-server",pid=359880))
tcp LISTEN *:3005 users:(("next-server",pid=363724))
tcp LISTEN *:3006 users:(("next-server",pid=364858))
```

### **Soluci√≥n:**
```bash
# ‚úÖ VERIFICAR: Todos los puertos del rango
ss -tulpn | grep -E ":(300[0-9])"

# ‚úÖ LIMPIAR: Procesos Next.js innecesarios
pkill -f "next-server"

# ‚úÖ VERIFICAR: Que se liberaron los puertos
ss -tulpn | grep -E ":(300[0-9])"

# ‚úÖ ARRANCAR: Una sola instancia limpia
cd aqualytics && npm run dev
```

### **Informaci√≥n de Proyecto:**
- **Ruta correcta:** `AquaLytics-dev/aqualytics` (no asumir)
- **Estructura:** Frontend en `/aqualytics`, Backend en `/api`
- **Puertos normales:** Frontend 3000, Backend 8000

### **Prevenci√≥n:**
- Siempre verificar rango de puertos antes de arrancar servicios
- Limpiar procesos hu√©rfanos regularmente
- Recordar rutas espec√≠ficas del proyecto

# UI/UX Component Errors

## Error: Component props not matching interface
- **Problem**: TypeScript errors when passing new props to components
- **Solution**: Always update the interface definition when adding new props
- **Example**: When adding `gradient` and `subtitle` to MetricCard, update MetricCardProps interface

## Error: Missing animations or jarring transitions
- **Problem**: UI feels static or transitions are too abrupt
- **Solution**: Add `transition-all duration-300` to interactive elements, use staggered delays for lists
- **Pattern**: 
  ```tsx
  className="transition-all duration-300 hover:scale-105"
  className="animate-in slide-in-from-bottom duration-500 delay-100"
  ```

## Error: Inconsistent visual hierarchy
- **Problem**: Elements don't have clear importance levels
- **Solution**: Use Phoenix theme gradients for primary elements, consistent spacing (gap-2, gap-4, gap-6)
- **Reference**: See [ui_ux_patterns.mdc](mdc:.cursor/rules/ui_ux_patterns.mdc)

## Error: Poor loading/error states
- **Problem**: Users see blank screens or confusing error messages  
- **Solution**: Always implement loading skeletons, clear error messages with retry actions
- **Pattern**: Center icon + title + description for empty/error states

## Error: Not using established theme classes
- **Problem**: Creating custom styles instead of using Phoenix theme
- **Solution**: Use `phoenix-card`, `phoenix-button`, `phoenix-gradient` classes from globals.css
- **Benefit**: Consistent look and built-in hover effects

## Error: Forgetting responsive design
- **Problem**: UI breaks on mobile or looks cramped
- **Solution**: Always use responsive grid classes and test at different breakpoints
- **Pattern**: `grid-cols-1 md:grid-cols-2 lg:grid-cols-4`
