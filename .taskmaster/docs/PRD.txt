# AquaLytics - Product Requirements Document (PRD)
## Documento Optimizado para TaskMaster AI

---

## 1. Executive Summary

**AquaLytics** es una aplicaci√≥n web moderna para an√°lisis avanzado de rendimiento en nataci√≥n competitiva. La aplicaci√≥n permite a entrenadores capturar, procesar y visualizar m√©tricas detalladas de rendimiento de nadadores, proporcionando insights valiosos para optimizar el entrenamiento.

**Valor Core:** Transformar datos manuales de nataci√≥n en insights visuales accionables para mejorar el rendimiento deportivo.

**Stack Tecnol√≥gico:** Next.js 15 + React 18 LTS + Python Serverless + Supabase PostgreSQL

---

## 2. Objetivos del MVP

### Objetivos Primarios:
1. **Ingesta de Datos:** Permitir entrada manual y carga CSV de m√©tricas de nataci√≥n
2. **C√°lculo Autom√°tico:** Procesar 6 m√©tricas autom√°ticas desde 10 m√©tricas manuales
3. **Visualizaci√≥n:** Mostrar gr√°ficos interactivos y modernos de rendimiento
4. **An√°lisis Comparativo:** Rankings por estilo y progresi√≥n temporal
5. **Gesti√≥n de Datos:** CRUD completo conectado a Supabase 'Phoenixdb'

### M√©tricas de √âxito:
- Tiempo de carga inicial < 2 segundos
- Procesamiento de datos < 500ms para 100 registros
- Interfaz responsive en dispositivos 320px - 1920px
- Adopci√≥n por 3+ entrenadores en primeras 2 semanas

---

## 3. Usuarios y Roles

### Usuario Principal: **Entrenadores**
- **Acceso:** Completo (CRUD)
- **Funciones:** Ingreso de datos, an√°lisis, comparaciones, reportes
- **Contexto de Uso:** An√°lisis post-entrenamiento, planificaci√≥n, evaluaci√≥n de progreso

### Usuario Secundario: **Nadadores** 
- **Acceso:** Solo lectura
- **Funciones:** Visualizaci√≥n de su progreso personal
- **Implementaci√≥n:** Post-MVP (con autenticaci√≥n)

---

## 4. Arquitectura T√©cnica

### 4.1 Stack Tecnol√≥gico Actualizado

#### Frontend:
```typescript
- Next.js 15 (App Router)
- React 18 LTS (estable, no beta)
- TypeScript 5.x
- TailwindCSS 3.x (tema Phoenix)
- Chart.js 4.x + react-chartjs-2 (gr√°ficos MVP)
- Zustand (state management)
- React Hook Form (formularios optimizados)
- @supabase/supabase-js 2.x
```

#### Backend:
```python
- Python 3.11
- Starlette (serverless framework)
- Pandas 2.3 (an√°lisis de datos)
- NumPy 1.27 (c√°lculos num√©ricos)
- supabase-py 2.3
- python-multipart (upload CSV)
```

#### Base de Datos:
```sql
- Supabase PostgreSQL
- Proyecto: 'Phoenixdb' (ID: ombbxzdptnasoipzpmfh)
- Real-time capabilities habilitadas
```

### 4.2 Diagrama de Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser       ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Next.js 15     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  Vercel Python  ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ  (React 18 LTS)  ‚îÇ    ‚îÇ   Serverless    ‚îÇ
‚îÇ - Chart.js      ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ - TailwindCSS   ‚îÇ    ‚îÇ - Zustand Store  ‚îÇ    ‚îÇ - Starlette     ‚îÇ
‚îÇ - Phoenix Theme ‚îÇ    ‚îÇ - Hook Forms     ‚îÇ    ‚îÇ - Pandas        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                        ‚îÇ
                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                         ‚ñº
                                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                ‚îÇ   Supabase      ‚îÇ
                                ‚îÇ  'Phoenixdb'    ‚îÇ
                                ‚îÇ  PostgreSQL     ‚îÇ
                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 5. Base de Datos - Estructura 'Phoenixdb'

### 5.1 Tablas Principales

#### **nadadores** (Swimmers)
```sql
- id_nadador (PK): integer
- nombre: varchar (nombre completo)
- edad: smallint (opcional)
- peso: smallint (opcional, en kg)
```

#### **competencias** (Competitions)
```sql
- competencia_id (PK): integer
- competencia: varchar (nombre del evento)
- periodo: daterange (rango de fechas)
```

#### **distancias** (Distances)
```sql
- distancia_id (PK): integer  
- distancia: integer (metros: 25, 50, 100, 200, 400, 800, 1500.)
```

#### **estilos** (Strokes)
```sql
- estilo_id (PK): integer
- estilo: varchar ('Crol', 'Pecho', 'Dorso', 'Mariposa', 'Combinado')
```

#### **fases** (Phases)
```sql
- fase_id (PK): integer
- fase: varchar ('Entrenamiento', 'Competencia', 'Prueba')
```

#### **parametros** (Parameters/Metrics)
```sql
- parametro_id (PK): integer
- parametro: varchar (nombre t√©cnico de la m√©trica)
- tipo: char ('M'=Manual, 'A'=Autom√°tica)
- global: boolean (true=m√©trica global, false=por segmento)
```

#### **registros** (Records) - Tabla Central
```sql
- registro_id (PK): bigint
- competencia_id (FK): integer
- fecha: date
- id_nadador (FK): integer
- distancia_id (FK): integer
- estilo_id (FK): integer
- fase_id (FK): integer
- parametro_id (FK): integer
- segmento: integer (1=primer 25m, 2=segundo 25m, null=global)
- valor: numeric (valor de la m√©trica)
```

### 5.2 M√©tricas Definidas (16 Total)

#### **M√©tricas Manuales (10):**
```json
{
  "manuales": [
    {"parametro": "T15 (1)", "label": "Tiempo 15m (Primer Segmento)", "unit": "seg", "format": "XX.XX"},
    {"parametro": "# de BRZ 1", "label": "Brazadas (Primer Segmento)", "unit": "brazadas", "format": "integer"},
    {"parametro": "T25 (1)", "label": "Tiempo 25m (Primer Segmento)", "unit": "seg", "format": "XX.XX"},
    {"parametro": "F1", "label": "Flecha (Primer Segmento)", "unit": "metros", "format": "X.XX"},
    {"parametro": "T15 (2)", "label": "Tiempo 15m (Segundo Segmento)", "unit": "seg", "format": "XX.XX"},
    {"parametro": "# de BRZ 2", "label": "Brazadas (Segundo Segmento)", "unit": "brazadas", "format": "integer"},
    {"parametro": "T25 (2)", "label": "Tiempo 25m (Segundo Segmento)", "unit": "seg", "format": "XX.XX"},
    {"parametro": "F2", "label": "Flecha (Segundo Segmento)", "unit": "metros", "format": "X.XX"},
    {"parametro": "T TOTAL", "label": "Tiempo Total", "unit": "seg", "format": "XX.XX"},
    {"parametro": "# de BRZ TOTAL", "label": "Total de Brazadas", "unit": "brazadas", "format": "integer"}
  ]
}
```

#### **M√©tricas Autom√°ticas (6):**
```json
{
  "automaticas": [
    {"parametro": "V1", "label": "Velocidad (Primer Segmento)", "unit": "m/s", "formula": "25 / T25(1)"},
    {"parametro": "V2", "label": "Velocidad (Segundo Segmento)", "unit": "m/s", "formula": "25 / T25(2)"},
    {"parametro": "V promedio", "label": "Velocidad Promedio", "unit": "m/s", "formula": "50 / T_TOTAL"},
    {"parametro": "DIST x BRZ", "label": "Distancia por Brazada", "unit": "m/brazada", "formula": "50 / BRZ_TOTAL"},
    {"parametro": "DIST sin F", "label": "Distancia sin Flecha", "unit": "metros", "formula": "50 - (F1 + F2)"},
    {"parametro": "F promedio", "label": "Promedio de Flecha", "unit": "metros", "formula": "(F1 + F2) / 2"}
  ]
}
```

---

## 6. Estructura de Archivos del Proyecto

```
aqualytics/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ next.config.js
‚îú‚îÄ‚îÄ tailwind.config.js
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ .env.local
‚îú‚îÄ‚îÄ .gitignore
‚îÇ
‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ globals.css              # Estilos globales + tema Phoenix
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx               # Layout principal con navegaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # Dashboard principal
‚îÇ   ‚îú‚îÄ‚îÄ loading.tsx              # Loading UI
‚îÇ   ‚îú‚îÄ‚îÄ not-found.tsx           # 404 personalizada
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ data-entry/             # Ingreso de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            # Selecci√≥n: Manual vs CSV
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manual/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx        # Formulario manual de m√©tricas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ csv/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx        # Upload y procesamiento CSV
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ analytics/              # Visualizaci√≥n y an√°lisis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            # Dashboard de m√©tricas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ swimmer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx    # Perfil individual del nadador
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ compare/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx        # Comparaci√≥n entre nadadores
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rankings/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx        # Rankings por estilo y progresi√≥n
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ api/                    # API Routes (Next.js)
‚îÇ       ‚îú‚îÄ‚îÄ swimmers/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts        # CRUD nadadores
‚îÇ       ‚îú‚îÄ‚îÄ competitions/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts        # CRUD competencias
‚îÇ       ‚îî‚îÄ‚îÄ upload-csv/
‚îÇ           ‚îî‚îÄ‚îÄ route.ts        # Proxy a Python serverless
‚îÇ
‚îú‚îÄ‚îÄ api/                        # Python Serverless Functions
‚îÇ   ‚îú‚îÄ‚îÄ ingest.py              # POST: Ingesta datos + c√°lculo autom√°tico
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py             # GET: Consulta m√©tricas y an√°lisis
‚îÇ   ‚îú‚îÄ‚îÄ calculations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ swimming_metrics.py # L√≥gica de c√°lculo de 6 m√©tricas autom√°ticas
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ supabase_client.py # Cliente Supabase configurado
‚îÇ       ‚îú‚îÄ‚îÄ data_validation.py # Validaciones de datos
‚îÇ       ‚îî‚îÄ‚îÄ csv_processor.py   # Procesamiento de archivos CSV
‚îÇ
‚îú‚îÄ‚îÄ components/                 # Componentes React reutilizables
‚îÇ   ‚îú‚îÄ‚îÄ ui/                    # Componentes base UI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Input.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Select.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Card.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Modal.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LoadingSpinner.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ layout/                # Componentes de layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx         # Header con navegaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.tsx        # Sidebar con filtros
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ forms/                 # Formularios espec√≠ficos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SwimmerForm.tsx    # Formulario de nadador
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MetricsForm.tsx    # Formulario de m√©tricas manuales
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CompetitionForm.tsx # Formulario de competencia
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ charts/                # Componentes de visualizaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MetricsChart.tsx   # Gr√°fico de m√©tricas (Chart.js)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProgressChart.tsx  # Gr√°fico de progresi√≥n temporal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ComparisonChart.tsx # Gr√°fico de comparaci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RankingTable.tsx   # Tabla de rankings
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ data/                  # Componentes de gesti√≥n de datos
‚îÇ       ‚îú‚îÄ‚îÄ DataSourceSelector.tsx # Selector CSV vs BD
‚îÇ       ‚îú‚îÄ‚îÄ CSVUploader.tsx    # Componente de upload CSV
‚îÇ       ‚îî‚îÄ‚îÄ DataFilters.tsx    # Filtros de datos
‚îÇ
‚îú‚îÄ‚îÄ lib/                       # Utilidades y configuraciones
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts           # Cliente Supabase (frontend)
‚îÇ   ‚îú‚îÄ‚îÄ store/                # Zustand stores
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ swimmers-store.ts # Estado de nadadores
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics-store.ts  # Estado de m√©tricas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui-store.ts       # Estado de UI (filtros, modales)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                # Custom React hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSwimmers.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useMetrics.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useChartData.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/                # Funciones utilitarias
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.ts     # Formateo de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.ts     # Validaciones frontend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chart-configs.ts  # Configuraciones Chart.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.ts      # Constantes de la aplicaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ types/                # Definiciones TypeScript
‚îÇ       ‚îú‚îÄ‚îÄ database.ts       # Tipos de BD Supabase
‚îÇ       ‚îú‚îÄ‚îÄ metrics.ts        # Tipos de m√©tricas
‚îÇ       ‚îî‚îÄ‚îÄ api.ts            # Tipos de API responses
‚îÇ
‚îú‚îÄ‚îÄ public/                    # Assets est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ icons/                # Iconos SVG del tema Phoenix
‚îÇ   ‚îú‚îÄ‚îÄ images/               # Im√°genes y logos
‚îÇ   ‚îî‚îÄ‚îÄ sample-data/          # Archivos CSV de ejemplo
‚îÇ       ‚îî‚îÄ‚îÄ sample-metrics.csv
‚îÇ
‚îî‚îÄ‚îÄ docs/                     # Documentaci√≥n
    ‚îú‚îÄ‚îÄ api-documentation.md
    ‚îú‚îÄ‚îÄ database-schema.md
    ‚îî‚îÄ‚îÄ development-guide.md
```

---

## 7. Especificaciones de UX/UI

### 7.1 Tema Visual "Phoenix"

#### **Paleta de Colores:**
```css
/* Colores Phoenix (sutiles pero visibles) */
--phoenix-red: #DC2626      /* Red-600 */
--phoenix-orange: #EA580C   /* Orange-600 */
--phoenix-yellow: #D97706   /* Amber-600 */

/* Gradientes sutiles */
--gradient-phoenix: linear-gradient(135deg, #DC2626 0%, #EA580C 50%, #D97706 100%)
--gradient-phoenix-soft: linear-gradient(135deg, #FEE2E2 0%, #FED7AA 50%, #FEF3C7 100%)

/* Colores neutros */
--gray-50: #F9FAFB
--gray-100: #F3F4F6
--gray-900: #111827
```

#### **Elementos con Gradientes Phoenix:**
- **Headers principales** (H1, t√≠tulos de secci√≥n)
- **Botones de acci√≥n primaria** (Guardar, Analizar, Exportar)
- **Cards de m√©tricas destacadas** (tiempo total, velocidad promedio)
- **Progress bars** de carga
- **Borders activos** en inputs seleccionados

### 7.2 Responsive Design

#### **Breakpoints:**
```css
/* Mobile First */
- mobile: 320px - 640px   (1 columna)
- tablet: 641px - 1024px  (2 columnas)
- desktop: 1025px+        (3+ columnas)
```

#### **Adaptaciones por Dispositivo:**
- **Mobile:** Navegaci√≥n hamburger, gr√°ficos stack vertical, formularios single-column
- **Tablet:** Sidebar colapsable, gr√°ficos 2x2 grid
- **Desktop:** Sidebar fija, dashboard multi-column, gr√°ficos inline

### 7.3 Modo Claro/Oscuro

```css
/* Implementaci√≥n con TailwindCSS dark mode */
.light-theme {
  --bg-primary: #FFFFFF;
  --bg-secondary: #F9FAFB;
  --text-primary: #111827;
  --text-secondary: #6B7280;
}

.dark-theme {
  --bg-primary: #111827;
  --bg-secondary: #1F2937;
  --text-primary: #F9FAFB;
  --text-secondary: #D1D5DB;
}
```

### 7.4 Efectos Hover

#### **Elementos Interactive:**
- **Botones:** Transform scale(1.05) + shadow enhancement
- **Cards:** Lift effect (shadow-lg) + border glow
- **Chart elements:** Highlight + tooltip
- **Navigation items:** Background gradient fade-in
- **Table rows:** Background color transition

---

## 8. Funcionalidades Detalladas

### 8.1 Dashboard Principal

#### **Componentes:**
1. **Header con m√©tricas clave:** Nadadores activos, competencias, √∫ltimo an√°lisis
2. **Gr√°ficos principales:**
   - Progresi√≥n temporal de velocidad promedio (√∫ltimos 30 d√≠as)
   - Distribuci√≥n de estilos por rendimiento
   - Top 5 nadadores por mejora reciente
3. **Acciones r√°pidas:** Nuevo registro, Cargar CSV, Ver rankings

### 8.2 Ingreso de Datos

#### **8.2.1 Formulario Manual:**
```typescript
interface MetricFormData {
  // Informaci√≥n b√°sica
  swimmer_id: number;
  competition_id: number;
  date: string;
  distance_id: number;
  stroke_id: number;
  phase_id: number;
  
  // M√©tricas manuales del primer segmento
  t15_1: number;    // Formato: XX.XX
  brz_1: number;    // Entero
  t25_1: number;    // Formato: XX.XX
  f1: number;       // Formato: X.XX
  
  // M√©tricas manuales del segundo segmento
  t15_2: number;
  brz_2: number;
  t25_2: number;
  f2: number;
  
  // M√©tricas globales manuales
  t_total: number;
  brz_total: number;
}
```

#### **Validaciones en Tiempo Real:**
- **Tiempos:** Rango 5.00 - 180.00 segundos
- **Brazadas:** Rango 1 - 100 brazadas
- **Flecha:** Rango 0.00 - 15.00 metros
- **Consistencia:** T_TOTAL ‚â• (T25_1 + T25_2)

#### **8.2.2 Carga CSV:**
```csv
# Formato esperado CSV
fecha,nadador,competencia,distancia,estilo,fase,t15_1,brz_1,t25_1,f1,t15_2,brz_2,t25_2,f2,t_total,brz_total
2024-01-15,Juan P√©rez,Nacional 2024,50,Crol,Competencia,7.23,8,12.45,8.5,7.89,9,13.12,7.8,25.57,17
```

### 8.3 Sistema de Filtros

#### **Filtros Disponibles:**
```typescript
interface DataFilters {
  // Filtros temporales
  dateFrom: string;
  dateTo: string;
  
  // Filtros de contexto
  swimmers: number[];        // IDs de nadadores
  competitions: number[];    // IDs de competencias
  distances: number[];       // IDs de distancias
  strokes: number[];         // IDs de estilos
  phases: number[];          // IDs de fases
  
  // Filtros de m√©tricas
  parameters: number[];      // IDs de par√°metros
  metricType: 'M' | 'A' | 'all'; // Manual, Autom√°tica o Todas
  
  // Filtros de rendimiento
  timeRange: [number, number]; // Rango de tiempos
  velocityRange: [number, number]; // Rango de velocidades
}
```

### 8.4 Visualizaciones Chart.js

#### **8.4.1 Gr√°fico de Progresi√≥n Temporal:**
```typescript
// Configuraci√≥n Chart.js para progresi√≥n
const progressionConfig = {
  type: 'line',
  data: {
    datasets: [{
      label: 'Velocidad Promedio',
      borderColor: 'linear-gradient(135deg, #DC2626, #EA580C)',
      backgroundColor: 'rgba(220, 38, 38, 0.1)',
      tension: 0.4
    }]
  },
  options: {
    responsive: true,
    interaction: {
      intersect: false,
      mode: 'index'
    },
    plugins: {
      tooltip: {
        backgroundColor: 'rgba(17, 24, 39, 0.95)',
        titleColor: '#F9FAFB',
        bodyColor: '#D1D5DB'
      }
    }
  }
};
```

#### **8.4.2 Gr√°fico de Comparaci√≥n de Nadadores:**
```typescript
// Radar chart para comparaci√≥n multi-m√©trica
const comparisonConfig = {
  type: 'radar',
  data: {
    labels: ['Velocidad', 'Eficiencia', 'Consistencia', 'T√©cnica'],
    datasets: [
      {
        label: 'Nadador A',
        borderColor: '#DC2626',
        backgroundColor: 'rgba(220, 38, 38, 0.2)'
      },
      {
        label: 'Nadador B', 
        borderColor: '#EA580C',
        backgroundColor: 'rgba(234, 88, 12, 0.2)'
      }
    ]
  }
};
```

### 8.5 Rankings y Comparaciones

#### **8.5.1 Ranking por Estilo:**
```sql
-- Query SQL para ranking por estilo
SELECT 
  n.nombre as swimmer_name,
  AVG(r1.valor) as avg_time,
  COUNT(*) as races_count,
  MIN(r1.valor) as best_time
FROM registros r1
JOIN nadadores n ON r1.id_nadador = n.id_nadador
JOIN parametros p ON r1.parametro_id = p.parametro_id
JOIN estilos e ON r1.estilo_id = e.estilo_id
WHERE p.parametro = 'T TOTAL' 
  AND e.estilo = 'Crol'
  AND r1.fecha >= '2024-01-01'
GROUP BY n.id_nadador, n.nombre
ORDER BY best_time ASC
LIMIT 10;
```

#### **8.5.2 Progresi√≥n Temporal Interactiva:**
- **Slider temporal:** Rango de fechas ajustable
- **Comparaci√≥n multi-nadador:** Hasta 4 nadadores simult√°neos
- **M√©tricas seleccionables:** Toggle entre diferentes par√°metros
- **Export de resultados:** CSV de datos del gr√°fico

---

## 9. API Endpoints

### 9.1 Next.js API Routes (TypeScript)

#### **GET /api/swimmers**
```typescript
// Listar todos los nadadores con m√©tricas b√°sicas
interface SwimmerResponse {
  id_nadador: number;
  nombre: string;
  edad?: number;
  peso?: number;
  total_races: number;
  best_time?: number;
  latest_race_date?: string;
}
```

#### **POST /api/swimmers**
```typescript
// Crear nuevo nadador
interface CreateSwimmerRequest {
  nombre: string;
  edad?: number;
  peso?: number;
}
```

### 9.2 Python Serverless Functions

#### **POST /api/ingest.py**
```python
# Ingesta de datos con c√°lculo autom√°tico
@app.route('/ingest', methods=['POST'])
async def ingest_metrics(request):
    """
    Procesa datos manuales y calcula m√©tricas autom√°ticas
    
    Input: JSON con m√©tricas manuales
    Output: Confirmaci√≥n + m√©tricas calculadas
    """
    # 1. Validar datos de entrada
    # 2. Insertar m√©tricas manuales en BD
    # 3. Calcular 6 m√©tricas autom√°ticas
    # 4. Insertar m√©tricas autom√°ticas
    # 5. Retornar resumen
```

#### **GET /api/metrics.py**
```python
# Consulta de m√©tricas con filtros
@app.route('/metrics', methods=['GET'])
async def get_metrics(request):
    """
    Consulta m√©tricas con filtros m√∫ltiples
    
    Query params: swimmer_id, competition_id, date_from, date_to, etc.
    Output: Datos formateados para gr√°ficos
    """
```

---

## 10. L√≥gica de C√°lculo de M√©tricas Autom√°ticas

### 10.1 Implementaci√≥n Python

```python
# api/calculations/swimming_metrics.py

class SwimmingMetricsCalculator:
    """
    Calcula las 6 m√©tricas autom√°ticas basadas en datos manuales
    """
    
    @staticmethod
    def calculate_segment_velocity(distance: float, time: float) -> float:
        """
        Calcula velocidad de segmento
        F√≥rmula: V = Distancia / Tiempo
        """
        if time <= 0:
            raise ValueError("Tiempo debe ser mayor a 0")
        return distance / time
    
    @staticmethod
    def calculate_average_velocity(total_distance: float, total_time: float) -> float:
        """
        Calcula velocidad promedio
        F√≥rmula: V_prom = Distancia_total / Tiempo_total
        """
        return SwimmingMetricsCalculator.calculate_segment_velocity(total_distance, total_time)
    
    @staticmethod
    def calculate_distance_per_stroke(total_distance: float, total_strokes: int) -> float:
        """
        Calcula distancia por brazada
        F√≥rmula: DPS = Distancia_total / Brazadas_total
        """
        if total_strokes <= 0:
            raise ValueError("Brazadas deben ser mayor a 0")
        return total_distance / total_strokes
    
    @staticmethod
    def calculate_distance_without_underwater(total_distance: float, f1: float, f2: float) -> float:
        """
        Calcula distancia sin fase subacu√°tica (flecha)
        F√≥rmula: Dist_sin_F = Distancia_total - (F1 + F2)
        """
        return total_distance - (f1 + f2)
    
    @staticmethod
    def calculate_average_underwater(f1: float, f2: float) -> float:
        """
        Calcula promedio de fase subacu√°tica
        F√≥rmula: F_promedio = (F1 + F2) / 2
        """
        return (f1 + f2) / 2
    
    def calculate_all_automatic_metrics(self, manual_data: dict) -> dict:
        """
        Calcula todas las m√©tricas autom√°ticas
        
        Args:
            manual_data: Dict con m√©tricas manuales requeridas
            
        Returns:
            Dict con 6 m√©tricas autom√°ticas calculadas
        """
        try:
            # Extraer datos manuales
            t25_1 = manual_data['t25_1']
            t25_2 = manual_data['t25_2'] 
            t_total = manual_data['t_total']
            brz_total = manual_data['brz_total']
            f1 = manual_data['f1']
            f2 = manual_data['f2']
            
            # Constantes
            SEGMENT_DISTANCE = 25.0
            TOTAL_DISTANCE = 50.0
            
            # Calcular m√©tricas autom√°ticas
            v1 = self.calculate_segment_velocity(SEGMENT_DISTANCE, t25_1)
            v2 = self.calculate_segment_velocity(SEGMENT_DISTANCE, t25_2)
            v_promedio = self.calculate_average_velocity(TOTAL_DISTANCE, t_total)
            dist_por_brz = self.calculate_distance_per_stroke(TOTAL_DISTANCE, brz_total)
            dist_sin_f = self.calculate_distance_without_underwater(TOTAL_DISTANCE, f1, f2)
            f_promedio = self.calculate_average_underwater(f1, f2)
            
            return {
                'V1': round(v1, 3),
                'V2': round(v2, 3),
                'V promedio': round(v_promedio, 3),
                'DIST x BRZ': round(dist_por_brz, 2),
                'DIST sin F': round(dist_sin_f, 2),
                'F promedio': round(f_promedio, 2)
            }
            
        except Exception as e:
            raise ValueError(f"Error calculando m√©tricas autom√°ticas: {str(e)}")
```

---

## 11. Validaciones de Datos

### 11.1 Validaciones Frontend (React Hook Form + Zod)

```typescript
// lib/utils/validators.ts

import { z } from 'zod';

export const MetricFormSchema = z.object({
  // Informaci√≥n b√°sica
  swimmer_id: z.number().min(1, "Selecciona un nadador"),
  competition_id: z.number().min(1, "Selecciona una competencia"),
  date: z.string().min(1, "Fecha es requerida"),
  distance_id: z.number().min(1, "Selecciona una distancia"),
  stroke_id: z.number().min(1, "Selecciona un estilo"),
  phase_id: z.number().min(1, "Selecciona una fase"),
  
  // M√©tricas del primer segmento
  t15_1: z.number()
    .min(3.0, "Tiempo m√≠nimo: 3.00 segundos")
    .max(30.0, "Tiempo m√°ximo: 30.00 segundos")
    .refine(val => Number(val.toFixed(2)) === val, "M√°ximo 2 decimales"),
    
  brz_1: z.number()
    .int("Debe ser un n√∫mero entero")
    .min(1, "M√≠nimo: 1 brazada")
    .max(50, "M√°ximo: 50 brazadas"),
    
  t25_1: z.number()
    .min(5.0, "Tiempo m√≠nimo: 5.00 segundos")
    .max(60.0, "Tiempo m√°ximo: 60.00 segundos")
    .refine(val => Number(val.toFixed(2)) === val, "M√°ximo 2 decimales"),
    
  f1: z.number()
    .min(0.0, "M√≠nimo: 0.00 metros")
    .max(15.0, "M√°ximo: 15.00 metros")
    .refine(val => Number(val.toFixed(2)) === val, "M√°ximo 2 decimales"),
    
  // Validaciones de consistencia temporal
}).refine(data => {
  return data.t25_1 > data.t15_1;
}, {
  message: "T25 debe ser mayor que T15",
  path: ["t25_1"]
}).refine(data => {
  return data.t_total >= (data.t25_1 + data.t25_2);
}, {
  message: "Tiempo total debe ser ‚â• suma de segmentos",
  path: ["t_total"]
});
```

### 11.2 Validaciones Backend (Python)

```python
# api/utils/data_validation.py

from typing import Dict, List, Tuple
import re

class DataValidator:
    """
    Validador de datos de m√©tricas de nataci√≥n
    """
    
    # Rangos v√°lidos por m√©trica
    VALIDATION_RULES = {
        't15_1': {'min': 3.0, 'max': 30.0, 'decimals': 2},
        't15_2': {'min': 3.0, 'max': 30.0, 'decimals': 2},
        't25_1': {'min': 5.0, 'max': 60.0, 'decimals': 2},
        't25_2': {'min': 5.0, 'max': 60.0, 'decimals': 2},
        't_total': {'min': 10.0, 'max': 120.0, 'decimals': 2},
        'brz_1': {'min': 1, 'max': 50, 'type': 'integer'},
        'brz_2': {'min': 1, 'max': 50, 'type': 'integer'},
        'brz_total': {'min': 2, 'max': 100, 'type': 'integer'},
        'f1': {'min': 0.0, 'max': 15.0, 'decimals': 2},
        'f2': {'min': 0.0, 'max': 15.0, 'decimals': 2}
    }
    
    def validate_single_metric(self, metric_name: str, value: float) -> Tuple[bool, str]:
        """
        Valida una m√©trica individual
        
        Returns:
            Tuple[bool, str]: (is_valid, error_message)
        """
        if metric_name not in self.VALIDATION_RULES:
            return False, f"M√©trica desconocida: {metric_name}"
        
        rules = self.VALIDATION_RULES[metric_name]
        
        # Validar tipo integer
        if rules.get('type') == 'integer':
            if not isinstance(value, int) or value != int(value):
                return False, f"{metric_name} debe ser un n√∫mero entero"
        
        # Validar rango
        if value < rules['min'] or value > rules['max']:
            return False, f"{metric_name} debe estar entre {rules['min']} y {rules['max']}"
        
        # Validar decimales
        if 'decimals' in rules:
            decimal_places = len(str(value).split('.')[-1]) if '.' in str(value) else 0
            if decimal_places > rules['decimals']:
                return False, f"{metric_name} m√°ximo {rules['decimals']} decimales"
        
        return True, ""
    
    def validate_consistency(self, data: Dict) -> List[str]:
        """
        Valida consistencia entre m√©tricas relacionadas
        
        Returns:
            List[str]: Lista de errores de consistencia
        """
        errors = []
        
        # T25 > T15 para cada segmento
        if data.get('t25_1', 0) <= data.get('t15_1', 0):
            errors.append("T25(1) debe ser mayor que T15(1)")
        
        if data.get('t25_2', 0) <= data.get('t15_2', 0):
            errors.append("T25(2) debe ser mayor que T15(2)")
        
        # Tiempo total >= suma de segmentos
        t_total = data.get('t_total', 0)
        t_segments = data.get('t25_1', 0) + data.get('t25_2', 0)
        if t_total < t_segments:
            errors.append(f"Tiempo total ({t_total}) debe ser ‚â• suma de segmentos ({t_segments})")
        
        # Brazadas total >= suma de segmentos
        brz_total = data.get('brz_total', 0)
        brz_segments = data.get('brz_1', 0) + data.get('brz_2', 0)
        if brz_total < brz_segments:
            errors.append(f"Brazadas total ({brz_total}) debe ser ‚â• suma de segmentos ({brz_segments})")
        
        return errors
```

---

## 12. Configuraci√≥n del Entorno

### 12.1 Variables de Entorno

```bash
# .env.local

# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://ombbxzdptnasoipzpmfh.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tYmJ4emRwdG5hc29pcHpwbWZoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MDkwMjgsImV4cCI6MjA2NDQ4NTAyOH0.5efbRXhg3JgrEDYRpPSqBe1n0q5Pfjv9CX19F5okAeU
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tYmJ4emRwdG5hc29pcHpwbWZoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0ODkwOTAyOCwiZXhwIjoyMDY0NDg1MDI4fQ.kCZDDMfFlN3eeKsQkrGvLeppj88qEVTRBFhKS8Zphq4

# App Configuration
NEXT_PUBLIC_APP_NAME=AquaLytics
NEXT_PUBLIC_APP_VERSION=1.0.0-MVP

# Python API Configuration
PYTHON_API_BASE_URL=https://aqualytics.vercel.app/api

# Development
NODE_ENV=development
```

### 12.2 Dependencies

#### **package.json**
```json
{
  "name": "aqualytics",
  "version": "1.0.0",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "next": "^15.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@supabase/supabase-js": "^2.39.0",
    "zustand": "^4.4.7",
    "react-hook-form": "^7.48.2",
    "@hookform/resolvers": "^3.3.2",
    "zod": "^3.22.4",
    "chart.js": "^4.4.0",
    "react-chartjs-2": "^5.2.0",
    "date-fns": "^2.30.0",
    "clsx": "^2.0.0",
    "tailwind-merge": "^2.0.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "typescript": "^5.3.0",
    "tailwindcss": "^3.3.0",
    "autoprefixer": "^10.4.0",
    "postcss": "^8.4.0",
    "eslint": "^8.54.0",
    "eslint-config-next": "^15.0.0"
  }
}
```

#### **requirements.txt**
```txt
starlette==0.36.3
pandas==2.2.0
numpy==1.26.2
supabase-py==2.3.0
python-multipart==0.0.6
python-dotenv==1.0.0
pydantic==2.5.0
uvicorn==0.24.0
httpx==0.25.2
```

---

## 13. Criterios de Aceptaci√≥n del MVP

### 13.1 Funcionalidades Core ‚úÖ

#### **Ingesta de Datos:**
- [ ] Formulario manual funcional con validaciones en tiempo real
- [ ] Upload de CSV con procesamiento autom√°tico
- [ ] C√°lculo autom√°tico de 6 m√©tricas derivadas
- [ ] Almacenamiento correcto en BD Supabase 'Phoenixdb'

#### **Visualizaci√≥n:**
- [ ] Dashboard principal con m√©tricas clave
- [ ] Gr√°ficos Chart.js responsive y interactive
- [ ] Tema Phoenix implementado (gradientes sutiles)
- [ ] Modo claro/oscuro funcional

#### **An√°lisis:**
- [ ] Sistema de filtros completo (temporal, nadador, estilo, m√©trica)
- [ ] Rankings por estilo con datos consistentes
- [ ] Comparaci√≥n de progresi√≥n temporal interactiva
- [ ] Exportaci√≥n de datos de gr√°ficos

### 13.2 Criterios T√©cnicos ‚úÖ

#### **Performance:**
- [ ] Tiempo de carga inicial < 2 segundos
- [ ] Procesamiento de CSV < 500ms para 100 registros
- [ ] Gr√°ficos renderizados < 200ms
- [ ] Bundle size total < 500KB (sin Chart.js cache)

#### **UX/UI:**
- [ ] Responsive design 320px - 1920px
- [ ] Efectos hover consistentes
- [ ] Navegaci√≥n intuitiva
- [ ] Labels user-friendly (no nombres t√©cnicos de BD)

#### **Calidad de C√≥digo:**
- [ ] TypeScript sin errores
- [ ] Componentes reutilizables < 200 l√≠neas
- [ ] Validaciones exhaustivas frontend + backend
- [ ] Manejo de errores elegante

---

## 14. Post-MVP (Roadmap)

### Versi√≥n 1.1:
- **Autenticaci√≥n:** Sistema de usuarios (entrenadores vs nadadores)
- **Notificaciones:** Alertas de datos inconsistentes
- **Plotly.js:** Gr√°ficos avanzados para an√°lisis profundo
- **Exportaci√≥n:** PDF reports autom√°ticos

### Versi√≥n 1.2:
- **ML Analytics:** Predicciones de rendimiento
- **Comparaci√≥n masiva:** Benchmarking contra bases de datos nacionales
- **M√≥vil nativo:** React Native app
- **API p√∫blica:** Para integraci√≥n con cron√≥metros digitales

---

## 15. Notas para TaskMaster AI

### **Importante para la Generaci√≥n de Tareas:**

1. **Usar nombres exactos de BD:** `nadadores.id_nadador`, `parametros.parametro`, etc.
2. **Labels user-friendly en UI:** "Nadador" en lugar de "id_nadador"
3. **Validaciones dobles:** Frontend (UX) + Backend (seguridad)
4. **Componentes modulares:** M√°ximo 200 l√≠neas por archivo
5. **Tema Phoenix consistente:** Gradientes sutiles pero visibles
6. **Chart.js configurado:** Para MVP, Plotly.js para post-MVP
7. **Estado centralizado:** Zustand stores por funcionalidad
8. **TypeScript estricto:** Tipado completo de BD y API

### **Estructura de Desarrollo Sugerida:**

2. **Componentes UI base:** Design system Phoenix
3. **Formularios:** Hook Forms + validaciones
4. **API Python:** C√°lculos autom√°ticos + ingesta
5. **Visualizaciones:** Chart.js + datos reales
6. **Filtros y an√°lisis:** Zustand + queries optimizadas
7. **Polish y optimizaci√≥n:** Performance + UX final

---

**üéØ Objetivo del MVP:** Una aplicaci√≥n web funcional, hermosa y r√°pida que permita a entrenadores analizar el rendimiento de nataci√≥n con datos reales y visualizaciones profesionales, estableciendo la base para futuras funcionalidades avanzadas.**